extract_text_from_images:
  description: >
    You will receive email content from the GmailReaderTool. Look for a section marked 
    "IMAGES_FOR_PROCESSING" which lists image URLs in the format:
    
    IMAGES_FOR_PROCESSING: <count>
    IMAGE_1: <url>
    IMAGE_2: <url>
    ...
    
    Your task is to process EACH image URL using the VisionTool to extract ONLY the text 
    content visible in each image.
    
    CRITICAL RULES:
    - Use VisionTool for EACH image URL listed in the IMAGES_FOR_PROCESSING section
    - Extract only text characters, words, and sentences visible in each image
    - Preserve line breaks and paragraph structure where visible
    - Do NOT describe what the image shows (people, objects, colors, layout)
    - Do NOT provide context or interpretation
    - If no text is visible in an image, note "No text found" for that image
    - If text is partially obscured or unclear, extract what is legible
    - Process ALL images in the list, one by one
    - If no IMAGES_FOR_PROCESSING section is found, return "No images to process"
    
    STRUCTURED OUTPUT FORMAT:
    You MUST return your response as a JSON object with the following structure:
    {
      "extracted_texts": [
        {
          "image_url": "https://example.com/image1.jpg",
          "extracted_text": "Text found in the image or 'No text found'",
          "has_text": true
        }
      ],
      "total_images_processed": 3,
      "images_with_text": 2
    }
    
    IMPORTANT JSON FORMATTING RULES:
    - Each image URL from IMAGES_FOR_PROCESSING must have an entry in extracted_texts array
    - Set has_text to true if text was found, false if no text was found
    - If no text is found, set extracted_text to "No text found"
    - total_images_processed should equal the count from IMAGES_FOR_PROCESSING
    - images_with_text should count how many images had has_text=true
    - If no IMAGES_FOR_PROCESSING section exists, return empty extracted_texts array with counts of 0
    
  expected_output: >
    A JSON object containing extracted text from all images with the following structure:
    
    {
      "extracted_texts": [
        {
          "image_url": "string - URL of the image",
          "extracted_text": "string - Text extracted from the image or 'No text found'",
          "has_text": "boolean - true if text was found, false otherwise"
        }
      ],
      "total_images_processed": "integer - Total number of images processed",
      "images_with_text": "integer - Number of images that contained text"
    }
    
    Example:
    {
      "extracted_texts": [
        {
          "image_url": "https://example.com/banner.jpg",
          "extracted_text": "Welcome to our Newsletter\nNovember 2025 Edition",
          "has_text": true
        },
        {
          "image_url": "https://example.com/logo.jpg",
          "extracted_text": "No text found",
          "has_text": false
        },
        {
          "image_url": "https://example.com/promo.jpg",
          "extracted_text": "50% OFF\nLimited Time Offer",
          "has_text": true
        }
      ],
      "total_images_processed": 3,
      "images_with_text": 2
    }
    
    If no images are found in the IMAGES_FOR_PROCESSING section:
    {
      "extracted_texts": [],
      "total_images_processed": 0,
      "images_with_text": 0
    }
  agent: image_text_extractor

cleanup_email_content:
  description: >
    Read all unread emails from these senders: {sender_emails} received in the last 
    {days} days and clean the content by removing template boilerplate from email 
    HEADERS and FOOTERS only. The message body must be preserved completely.
    
    For each email, identify and remove:
    
    HEADER BOILERPLATE (remove these):
    - Automated message notices ("This is an automated message, please do not reply")
    - Browser viewing suggestions ("For best viewing, open this email in your browser")
    - Do-not-reply warnings ("Do not reply to this email address")
    - Standard header banners with generic messaging
    
    FOOTER BOILERPLATE (remove these):
    - Email footers (typically after horizontal lines, multiple blank lines, or footer markers)
    - Repetitive contact information (phone numbers, email addresses, physical addresses, social media links)
    - Legal text (copyright notices, confidentiality statements, regulatory disclosures, 
      terms of service links, privacy policy links)
    - Unsubscribe mechanisms (unsubscribe links, preference center links, opt-out instructions)
    - Company information that appears in every email (company name, address, registration details)
    - "Follow us on social media" blocks in footers
    
    CRITICAL PRESERVATION RULES:
    - **PRESERVE THE COMPLETE MESSAGE BODY** - do not remove any content from the main message
    - **PRESERVE ALL IMAGES_FOR_PROCESSING SECTIONS** - if the email contains a section marked 
      "IMAGES_FOR_PROCESSING" with image URLs, you MUST preserve it EXACTLY as is
    - Preserve ALL promotional content, offers, and announcements from the message body
    - Preserve ALL action items, deadlines, and important details from the message body
    - Only remove template elements from headers (before message body) and footers (after message body)
    - If uncertain whether content is header/footer or message body, preserve it
    - The message body is the primary content between any header boilerplate and footer boilerplate
    
    EXAMPLES OF BOILERPLATE TO REMOVE (from headers/footers only):
    - "This is an automated message. Please do not reply to this email."
    - "View this email in your browser | Forward to a friend"
    - "PT Bank OCBC NISP Tbk, OCBC Tower, Jl. Prof. Dr. Satrio Kav 25, Jakarta..."
    - "You are receiving this email because you registered your email with our service..."
    - "Unsubscribe | Privacy Policy | Terms & Conditions"
    - "Â© 2024 Company Name. All rights reserved."
    - "This email and any attachments are confidential..."
    - "Follow us: [Facebook] [Twitter] [Instagram]" (only in footers)
    
    STRUCTURED OUTPUT FORMAT:
    You MUST return your response as a JSON object with the following structure:
    {
      "emails": [
        {
          "subject": "Email subject line",
          "sender": "sender@example.com",
          "timestamp": "2025-11-19T10:30:00Z",
          "body": "Cleaned email body text with boilerplate removed",
          "image_urls": ["https://example.com/image1.jpg", "https://example.com/image2.jpg"]
        }
      ],
      "total_count": 5
    }
    
    IMPORTANT JSON FORMATTING RULES:
    - Use ISO 8601 format for timestamps (YYYY-MM-DDTHH:MM:SSZ)
    - Include empty array [] for image_urls if no images are present
    - Ensure all strings are properly escaped
    - The body field should contain the cleaned message body text
    - The total_count field should match the number of emails in the emails array
  expected_output: >
    A JSON object containing a list of cleaned emails with the following structure:
    
    {
      "emails": [
        {
          "subject": "string - Email subject line",
          "sender": "string - Sender email address",
          "timestamp": "string - ISO 8601 datetime (e.g., 2025-11-19T10:30:00Z)",
          "body": "string - Cleaned message body with boilerplate removed",
          "image_urls": ["string array - List of image URLs found in the email"]
        }
      ],
      "total_count": "integer - Total number of emails processed"
    }
    
    Example:
    {
      "emails": [
        {
          "subject": "Weekly Newsletter - November 2025",
          "sender": "newsletter@example.com",
          "timestamp": "2025-11-19T10:30:00Z",
          "body": "Here are this week's top stories...",
          "image_urls": ["https://example.com/banner.jpg"]
        },
        {
          "subject": "Action Required: Update Your Profile",
          "sender": "support@example.com",
          "timestamp": "2025-11-18T14:20:00Z",
          "body": "Please update your profile information by Friday...",
          "image_urls": []
        }
      ],
      "total_count": 2
    }
    
    The output should contain only message-specific information without 
    footers, legal disclaimers, or repetitive organizational metadata.
  agent: email_analyst

analyze_emails:
  description: >
    Based on the cleaned email content and extracted image texts provided, create a comprehensive summary 
    in {language} language.
    
    The content has already been cleaned to remove headers, footers, and boilerplate.
    If image text extraction was performed, those texts have been provided as well.
    
    Focus on extracting and organizing:
    - Key information and main points from each message
    - Information extracted from images (if provided)
    - Action items and requests
    - Deadlines and time-sensitive information
    - Overall priority assessment
    
    Organize the information in a clear and readable format.
    
    IMPORTANT: You MUST write your entire summary in {language} language. 
    All text, headings, and descriptions must be in {language}.
    
    STRUCTURED OUTPUT FORMAT:
    You MUST return your response as a JSON object with the following structure:
    {
      "total_count": 5,
      "email_summaries": [
        {
          "subject": "Email subject",
          "sender": "sender@example.com",
          "timestamp": "2025-11-19T10:30:00Z",
          "key_points": ["Key point 1", "Key point 2"],
          "action_items": ["Action item 1", "Action item 2"],
          "has_deadline": true
        }
      ],
      "action_items": ["All action items from all emails"],
      "priority_assessment": "Overall priority assessment text",
      "summary_text": "Full markdown-formatted summary for backward compatibility"
    }
    
    IMPORTANT JSON FORMATTING RULES:
    - total_count should match the number of emails analyzed
    - email_summaries array should contain one entry per email
    - Use ISO 8601 format for timestamps (YYYY-MM-DDTHH:MM:SSZ)
    - key_points should be an array of strings, each representing a key point from that email
    - action_items in each email_summary should contain action items specific to that email
    - action_items at the root level should contain ALL action items from ALL emails
    - has_deadline should be true if the email contains time-sensitive information
    - priority_assessment should be a text assessment (e.g., "High", "Medium", "Low" with explanation)
    - summary_text should contain the full markdown-formatted summary for backward compatibility
    - All text content (key_points, action_items, priority_assessment, summary_text) MUST be in {language} language
  expected_output: >
    A JSON object containing structured email analysis with the following structure:
    
    {
      "total_count": "integer - Total number of emails analyzed",
      "email_summaries": [
        {
          "subject": "string - Email subject",
          "sender": "string - Sender email address",
          "timestamp": "string - ISO 8601 datetime (e.g., 2025-11-19T10:30:00Z)",
          "key_points": ["string array - Key points from this email"],
          "action_items": ["string array - Action items from this email"],
          "has_deadline": "boolean - Whether email contains time-sensitive information"
        }
      ],
      "action_items": ["string array - All action items from all emails combined"],
      "priority_assessment": "string - Overall priority assessment",
      "summary_text": "string - Full markdown-formatted summary"
    }
    
    Example:
    {
      "total_count": 2,
      "email_summaries": [
        {
          "subject": "Weekly Newsletter - November 2025",
          "sender": "newsletter@example.com",
          "timestamp": "2025-11-19T10:30:00Z",
          "key_points": [
            "New product launch announced for December",
            "Q4 sales exceeded expectations by 15%"
          ],
          "action_items": [
            "Review product specifications by Friday"
          ],
          "has_deadline": true
        },
        {
          "subject": "Team Meeting Notes",
          "sender": "manager@example.com",
          "timestamp": "2025-11-18T14:20:00Z",
          "key_points": [
            "Project timeline updated",
            "New team member joining next week"
          ],
          "action_items": [
            "Prepare onboarding materials",
            "Update project documentation"
          ],
          "has_deadline": false
        }
      ],
      "action_items": [
        "Review product specifications by Friday",
        "Prepare onboarding materials",
        "Update project documentation"
      ],
      "priority_assessment": "Medium priority - One deadline this week, other items can be scheduled flexibly",
      "summary_text": "# Email Summary\n\n## Overview\nAnalyzed 2 emails...\n\n## Key Points\n- New product launch...\n\n## Action Items\n1. Review product specifications by Friday\n2. Prepare onboarding materials\n3. Update project documentation"
    }
    
    The entire output, including all text fields, must be written in {language} language.
  agent: email_analyst
